@model WebApplication1.ViewModels.EmployeeDetailViewModel
@{
    ViewData["Title"] = Model.Employee.FullName;
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    /* Using similar styles from the Profile page for consistency */
    .profile-label {
        font-weight: bold;
        font-size: 0.93rem;
        color: #555;
    }

    .accordion-button:not(.collapsed) {
        color: #0c63e4;
        background-color: #e7f1ff;
    }

    .accordion-body ul {
        padding-left: 20px;
        margin-bottom: 0;
    }

    .rounded-4 {
        border-radius: 1.5rem !important;
    }

    .table thead th {
        font-weight: bold;
        background-color: #f2f8fa !important;
        border-top: none !important;
    }
</style>

<div class="container mt-4" style="max-width:900px;">
    <!-- Main Employee Card -->
    <div class="card shadow-lg rounded-4 p-4 mb-4">
        <div class="row g-0 align-items-center">
            <div class="col-md-3 text-center mb-3 mb-md-0">
                <h4 class="mt-3 fw-bold">@Model.Employee.FullName</h4>
                @if (!string.IsNullOrEmpty(Model.Employee.JobTitle))
                {
                    <div class="badge bg-info text-dark px-3 py-2 rounded-3 mb-2">@Model.Employee.JobTitle</div>
                }
            </div>
            <div class="col-md-9">
                <div class="d-flex justify-content-end mb-3">
                    <a asp-action="Index" class="btn btn-outline-secondary"><i class="fas fa-arrow-left me-2"></i>Back to List</a>
                </div>
                <div class="table-responsive">
                    <table class="table table-borderless table-sm mb-0">
                        <tbody>
                            <tr><th class="w-25 text-end profile-label">Job Title:</th><td>@Model.Employee.JobTitle</td></tr>
                            <tr><th class="text-end profile-label">Department:</th><td>@Model.Employee.Department</td></tr>
                            <tr><th class="text-end profile-label">Email:</th><td>@Model.Employee.Email</td></tr>
                            <tr><th class="text-end profile-label">Phone:</th><td>@Model.Employee.PhoneNumber</td></tr>
                            <tr><th class="text-end profile-label">Hire Date:</th><td>@(Model.Employee.HireDate?.ToString("dd MMM, yyyy") ?? "-")</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabs for Licenses, Certificates, Observations, and Projects -->
    <div class="card shadow rounded-4 p-3">
        <ul class="nav nav-tabs nav-justified mb-3" id="detailsTabs" role="tablist">
            <li class="nav-item" role="presentation"><button class="nav-link active" id="licenses-tab" data-bs-toggle="tab" data-bs-target="#licenses" type="button" role="tab"><i class="fa-solid fa-id-card"></i> Licenses</button></li>
            <li class="nav-item" role="presentation"><button class="nav-link" id="certs-tab" data-bs-toggle="tab" data-bs-target="#certs" type="button" role="tab"><i class="fa-solid fa-certificate"></i> Certificates</button></li>
            <li class="nav-item" role="presentation"><button class="nav-link" id="obs-tab" data-bs-toggle="tab" data-bs-target="#obs" type="button" role="tab"><i class="fa-solid fa-plane-departure"></i> Observations</button></li>
            <li class="nav-item" role="presentation"><button class="nav-link" id="projects-tab" data-bs-toggle="tab" data-bs-target="#projects" type="button" role="tab"><i class="fa-solid fa-diagram-project"></i> Courses</button></li>
        </ul>
        <div class="tab-content" id="detailsTabsContent">
            <!-- Licenses Tab -->
            <div class="tab-pane fade show active" id="licenses" role="tabpanel">
                @if (Model.Licenses != null && Model.Licenses.Any())
                {
                    <div class="table-responsive">
                        <table class="table table-bordered align-middle text-center">
                            <thead class="table-light"><tr><th>#</th><th>Type</th><th>Issue Date</th><th>Expiry Date</th><th>File</th></tr></thead>
                            <tbody>
                                @foreach (var (lic, i) in Model.Licenses.Select((item, index) => (item, index)))
                                {
                                    <tr><td>@(i + 1)</td><td>@lic.TypeName</td><td>@(lic.IssueDate?.ToString("dd-MMM-yyyy") ?? "-")</td><td>@(lic.ExpiryDate?.ToString("dd-MMM-yyyy") ?? "-")</td><td>@if (!string.IsNullOrEmpty(lic.FilePath)) {
                                    <a href="@Url.Content(lic.FilePath)" target="_blank" class="btn btn-outline-success btn-sm"><i class="fa-solid fa-download"></i></a>
                                } else
                                {

                                    <span class="text-muted small">N/A</span>
                                }
    </td></tr>
                            }
                        </tbody>
                    </table>
                </div>
                                } else
                {

                    <div class="alert alert-light text-center">No licenses found for this employee.</div>
                }
            </div>
            <!-- Certificates Tab -->
            <div class="tab-pane fade" id="certs" role="tabpanel">
                @if (Model.Certificates != null && Model.Certificates.Any())
                {
                    <div class="table-responsive">
                        <table class="table table-bordered align-middle text-center">
                            <thead class="table-light"><tr><th>#</th><th>Type</th><th>Title</th><th>Status</th><th>File</th></tr></thead>
                            <tbody>
                                @foreach (var (cert, i) in Model.Certificates.Select((item, index) => (item, index)))
                                {
                                    <tr><td>@(i + 1)</td><td>@cert.TypeName</td><td>@cert.Title</td><td>@cert.Status</td><td>@if (!string.IsNullOrEmpty(cert.FilePath)) {
                                    <a href="@Url.Content(cert.FilePath)" target="_blank" class="btn btn-outline-success btn-sm"><i class="fa-solid fa-download"></i></a>
                                } else
                                {

                                    <span class="text-muted small">N/A</span>
                                }
    </td></tr>
                            }
                        </tbody>
                    </table>
                </div>
                                } else
                {

                    <div class="alert alert-light text-center">No certificates found for this employee.</div>
                }
            </div>
            <!-- Observations Tab -->
            <div class="tab-pane fade" id="obs" role="tabpanel">
                @if (Model.Observations != null && Model.Observations.Any())
                {
                    <div class="table-responsive">
                        <table class="table table-bordered align-middle text-center">
                            <thead class="table-light"><tr><th>#</th><th>Country</th><th>License No.</th><th>Duration</th><th>Depart Date</th><th>Return Date</th></tr></thead>
                            <tbody>
                                @foreach (var (obs, i) in Model.Observations.Select((item, index) => (item, index)))
                                {
                                    <tr><td>@(i + 1)</td><td>@obs.TravelCountry</td><td>@obs.LicenseNumber</td><td>@obs.DurationDays days</td><td>@obs.DepartDate?.ToString("dd-MMM-yyyy")</td><td>@obs.ReturnDate?.ToString("dd-MMM-yyyy")</td></tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {

                    <div class="alert alert-light text-center">No observations found for this employee.</div>
                }
            </div>
            <!-- Projects Tab -->
            <div class="tab-pane fade" id="projects" role="tabpanel">
                @if (Model.Projects != null && Model.Projects.Any())
                {
                    <div class="accordion" id="projectsAccordion">
                        @foreach (var (pvm, index) in Model.Projects.Select((item, i) => (item, i)))
                        {
                            var project = pvm.Project;
                            string collapseId = $"collapse-emp-{project.ProjectId}";
                            string headerId = $"header-emp-{project.ProjectId}";
                            var statusBadge = project.Status switch
                            {
                                "Completed" => "badge bg-success",
                                "In Progress" => "badge bg-primary",
                                "On Hold" => "badge bg-secondary",
                                "Cancelled" => "badge bg-danger",
                                _ => "badge bg-warning text-dark"
                            };

                            <div class="accordion-item">
                                <h2 class="accordion-header" id="@headerId">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#@collapseId">
                                        <span class="fw-bold me-auto">#@(index + 1) - @project.ProjectName</span>
                                        <span class="@statusBadge">@project.Status</span>
                                    </button>
                                </h2>
                                <div id="@collapseId" class="accordion-collapse collapse" data-bs-parent="#projectsAccordion">
                                    <div class="accordion-body">
                                        @if (!string.IsNullOrEmpty(project.Description))
                                        {
                                            <p><strong>Description:</strong> @project.Description</p>
                                            <hr />
         }
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <h6><i class="fa-solid fa-info-circle text-primary"></i> Main Info</h6>
                                                <p class="mb-1"><small><strong>Start:</strong> @(project.StartDate?.ToString("dd MMM, yyyy") ?? "-")</small></p>
                                                <p class="mb-1"><small><strong>End:</strong> @(project.EndDate?.ToString("dd MMM, yyyy") ?? "-")</small></p>
                                                <p class="mb-0"><small><strong>Location:</strong> @(project.Location ?? "N/A")</small></p>
                                            </div>
                                            <div class="col-md-6">
                                                @if (pvm.Participants.Any())
                                                {
                                                    <h6><i class="fa-solid fa-users text-primary"></i> Participants</h6>
                                                    <ul> @foreach(var p in pvm.Participants.Take(5)) {
                                                    <li><small>@p</small></li>
                                                }
         @if (pvm.Participants.Count > 5)
        {
                                                    <li class="text-muted"><small>+@(pvm.Participants.Count - 5) more</small></li>
                                                }
        </ul>
    }
                                        </div>
                                    </div>
                                    @if (pvm.Divisions.Any())
                                    {
                                        <hr />
                                        <h6><i class="fa-solid fa-building text-primary"></i> Divisions</h6>

                                        <div>@foreach(var d in pvm.Divisions) {
                                        <span class="badge bg-light text-dark me-1">@d</span>
                                    }
    </div>
                                }
                            </div>
                        </div>
                    </div>
                                        }
                </div>
                                }
                                else
                {

                    <div class="alert alert-info text-center">This employee is not assigned to any Courses.</div>
                }
            </div>
        </div>
    </div>
</div>
