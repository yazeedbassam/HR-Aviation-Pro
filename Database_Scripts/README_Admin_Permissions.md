# دليل منح جميع الصلاحيات للمستخدم admin

## 📋 نظرة عامة

هذا الدليل يوضح كيفية منح جميع الصلاحيات المطلوبة للمستخدم `admin` في قاعدة البيانات على Railway.

## 📁 الملفات المتاحة

### 1. `Grant_All_Permissions_To_Admin.sql`
- **الوصف**: سكريبت شامل ومفصل لمنح جميع الصلاحيات
- **المميزات**:
  - إنشاء المستخدم admin إذا لم يكن موجوداً
  - منح جميع أنواع الصلاحيات
  - تسجيل مفصل للعمليات
  - التحقق من النتائج
- **الاستخدام**: للمراجعة الشاملة والتطبيق الآمن

### 2. `Quick_Admin_Permissions.sql`
- **الوصف**: سكريبت سريع ومبسط
- **المميزات**:
  - تنفيذ سريع
  - استخدام `ON CONFLICT` لتجنب الأخطاء
  - أقل تفصيلاً في التسجيل
- **الاستخدام**: للتنفيذ السريع في بيئة الإنتاج

## 🚀 كيفية التنفيذ على Railway

### الطريقة الأولى: عبر Railway Dashboard

1. **اذهب إلى Railway Dashboard**
   - افتح [Railway Dashboard](https://railway.app)
   - اختر مشروعك

2. **افتح قاعدة البيانات**
   - اذهب إلى قسم "Database"
   - اضغط على "Query" أو "Connect"

3. **نفذ السكريبت**
   ```sql
   -- انسخ والصق محتوى Quick_Admin_Permissions.sql
   ```

### الطريقة الثانية: عبر psql

1. **اتصل بقاعدة البيانات**
   ```bash
   psql $DATABASE_URL
   ```

2. **نفذ السكريبت**
   ```sql
   \i Database_Scripts/Quick_Admin_Permissions.sql
   ```

### الطريقة الثالثة: عبر التطبيق

1. **استخدم endpoint مؤقت**
   - أضف endpoint في `AccountController.cs`:
   ```csharp
   [HttpGet]
   [AllowAnonymous]
   public async Task<IActionResult> GrantAdminPermissions()
   {
       // تنفيذ السكريبت
   }
   ```

## ✅ التحقق من النجاح

بعد تنفيذ السكريبت، تحقق من:

1. **تسجيل الدخول**
   - Username: `admin`
   - Password: `123`

2. **التحقق من الصلاحيات**
   ```sql
   SELECT 
       cu.username,
       cu.role,
       COUNT(up.permission_key) as permissions_count
   FROM controller_users cu
   LEFT JOIN user_permissions up ON cu.id = up.user_id
   WHERE cu.username = 'admin'
   GROUP BY cu.id, cu.username, cu.role;
   ```

## 🔧 الصلاحيات الممنوحة

### 1. صلاحيات النظام
- ✅ إدارة المستخدمين
- ✅ إدارة الأدوار
- ✅ إدارة الصلاحيات
- ✅ عرض السجلات
- ✅ إدارة التكوين
- ✅ النسخ الاحتياطي والاستعادة

### 2. صلاحيات الأقسام
- ✅ عرض جميع الأقسام
- ✅ تعديل جميع الأقسام
- ✅ حذف الأقسام
- ✅ إدارة مستخدمي الأقسام

### 3. صلاحيات الشهادات
- ✅ جميع أنواع الشهادات (AFTN, AIS, CNS, ATFM, etc.)
- ✅ عرض، تعديل، حذف، موافقة

### 4. صلاحيات الرخص
- ✅ جميع أنواع الرخص
- ✅ عرض، تعديل، حذف، موافقة

### 5. صلاحيات المراقبة
- ✅ جميع أنواع المراقبة
- ✅ عرض، تعديل، حذف، موافقة

### 6. صلاحيات الموظفين
- ✅ عرض جميع الموظفين
- ✅ تعديل جميع الموظفين
- ✅ حذف الموظفين
- ✅ إدارة الرواتب
- ✅ إدارة العقود

### 7. صلاحيات التقارير
- ✅ عرض جميع التقارير
- ✅ تصدير التقارير
- ✅ جدولة التقارير
- ✅ إدارة قوالب التقارير

## ⚠️ تحذيرات مهمة

1. **الأمان**: هذا السكريبت يمنح صلاحيات كاملة - استخدمه بحذر
2. **البيئة**: تأكد من تنفيذه في البيئة الصحيحة
3. **النسخ الاحتياطي**: قم بعمل نسخة احتياطية قبل التنفيذ
4. **المراجعة**: راجع السكريبت قبل التنفيذ

## 🆘 استكشاف الأخطاء

### خطأ: "User admin does not exist"
```sql
-- تأكد من وجود الجدول
SELECT * FROM controller_users WHERE username = 'admin';
```

### خطأ: "Table does not exist"
```sql
-- تأكد من وجود الجداول المطلوبة
\dt
```

### خطأ: "Permission denied"
```sql
-- تأكد من صلاحيات المستخدم
SELECT current_user;
```

## 📞 الدعم

إذا واجهت أي مشاكل:
1. تحقق من سجلات Railway
2. راجع رسائل الخطأ في قاعدة البيانات
3. تأكد من صحة connection string

---

**تاريخ آخر تحديث**: 2025-01-09  
**الإصدار**: 1.0  
**المطور**: HR Aviation System