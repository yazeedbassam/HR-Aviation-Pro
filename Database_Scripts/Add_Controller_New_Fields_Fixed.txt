-- =============================================
-- Add new fields to controllers table (FIXED VERSION)
-- =============================================

USE [HR-Aviation]
GO

PRINT 'بدء إضافة الأعمدة الجديدة...'

-- Add NeedLicense column if it doesn't exist
IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'controllers' AND COLUMN_NAME = 'NeedLicense')
BEGIN
    ALTER TABLE controllers ADD NeedLicense BIT DEFAULT 1 NOT NULL;
    PRINT 'تم إضافة عمود NeedLicense'
END
ELSE
BEGIN
    PRINT 'عمود NeedLicense موجود بالفعل'
END

GO

-- Add IsActive column if it doesn't exist
IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'controllers' AND COLUMN_NAME = 'IsActive')
BEGIN
    ALTER TABLE controllers ADD IsActive BIT DEFAULT 1 NOT NULL;
    PRINT 'تم إضافة عمود IsActive'
END
ELSE
BEGIN
    PRINT 'عمود IsActive موجود بالفعل'
END

GO

-- Update existing records (only if columns exist)
IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'controllers' AND COLUMN_NAME = 'NeedLicense')
BEGIN
    UPDATE controllers SET NeedLicense = 1 WHERE NeedLicense IS NULL;
    PRINT 'تم تحديث قيم NeedLicense'
END

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'controllers' AND COLUMN_NAME = 'IsActive')
BEGIN
    UPDATE controllers SET IsActive = 1 WHERE IsActive IS NULL;
    PRINT 'تم تحديث قيم IsActive'
END

GO

-- Show results
SELECT COLUMN_NAME, DATA_TYPE, IS_NULLABLE, COLUMN_DEFAULT
FROM INFORMATION_SCHEMA.COLUMNS 
WHERE TABLE_NAME = 'controllers' AND COLUMN_NAME IN ('NeedLicense', 'IsActive')
ORDER BY COLUMN_NAME;

PRINT 'تم إضافة الأعمدة بنجاح!'
GO 