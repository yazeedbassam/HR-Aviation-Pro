# Database Setup Scripts

## نظرة عامة
هذا المجلد يحتوي على سكريبتات قاعدة البيانات لإعداد نظام إدارة الموارد البشرية للطيران.

## الملفات المتاحة

### 1. Complete_System_Setup.sql ⭐ **الأفضل**
**الوصف**: سكريبت شامل لإنشاء النظام الكامل في Supabase
**المحتوى**:
- إنشاء جميع الجداول الأساسية
- إنشاء الفهارس لتحسين الأداء
- إدراج الصلاحيات والأقسام
- إنشاء المستخدم الإداري
- إنشاء Views و Functions
- تسجيل إنشاء النظام

**كيفية الاستخدام**:
1. افتح Supabase Dashboard
2. اذهب إلى SQL Editor
3. انسخ والصق محتوى الملف
4. اضغط على "Run" لتنفيذ السكريبت

### 2. Create_Basic_Tables.sql
**الوصف**: سكريبت لإنشاء الجداول الأساسية فقط
**المحتوى**:
- إنشاء جميع الجداول الأساسية
- إنشاء الفهارس
- عرض معلومات الجداول المُنشأة

**كيفية الاستخدام**:
1. افتح Supabase Dashboard
2. اذهب إلى SQL Editor
3. انسخ والصق محتوى الملف
4. اضغط على "Run" لتنفيذ السكريبت

### 3. Create_Admin_User.sql
**الوصف**: سكريبت لإنشاء المستخدم الإداري فقط
**المحتوى**:
- التحقق من وجود الجداول المطلوبة
- إدراج الصلاحيات الأساسية
- إنشاء المستخدم الإداري
- منح جميع الصلاحيات للمستخدم الإداري

**كيفية الاستخدام**:
1. تأكد من تنفيذ Create_Basic_Tables.sql أولاً
2. افتح Supabase Dashboard
3. اذهب إلى SQL Editor
4. انسخ والصق محتوى الملف
5. اضغط على "Run" لتنفيذ السكريبت

### 4. Create_Views.sql
**الوصف**: سكريبت لإنشاء Views مفيدة للنظام
**المحتوى**:
- UserPermissionsView: عرض معلومات المستخدم مع صلاحياته
- AvailablePermissionsView: عرض الصلاحيات المتاحة
- DepartmentUsersView: عرض الأقسام مع عدد المستخدمين
- ActivityLogView: عرض سجل الأنشطة
- SystemStatisticsView: عرض إحصائيات النظام
- Views أخرى مفيدة

**كيفية الاستخدام**:
1. تأكد من وجود الجداول الأساسية
2. افتح Supabase Dashboard
3. اذهب إلى SQL Editor
4. انسخ والصق محتوى الملف
5. اضغط على "Run" لتنفيذ السكريبت

### 5. Create_Functions.sql
**الوصف**: سكريبت لإنشاء Functions مفيدة للنظام
**المحتوى**:
- CheckUserPermission: التحقق من صلاحية المستخدم
- CheckUserDepartmentPermission: التحقق من صلاحية المستخدم في قسم معين
- LogUserLogin: تسجيل دخول المستخدم
- LogUserActivity: تسجيل الأنشطة
- GetSystemStatistics: الحصول على إحصائيات النظام
- Functions أخرى مفيدة

**كيفية الاستخدام**:
1. تأكد من وجود الجداول الأساسية
2. افتح Supabase Dashboard
3. اذهب إلى SQL Editor
4. انسخ والصق محتوى الملف
5. اضغط على "Run" لتنفيذ السكريبت

### 6. Test_Connection.sql
**الوصف**: سكريبت لاختبار الاتصال بقاعدة البيانات
**المحتوى**:
- اختبار الاتصال الأساسي
- اختبار إنشاء الجداول المؤقتة
- اختبار الصلاحيات
- اختبار الأداء
- عرض معلومات النظام

**كيفية الاستخدام**:
1. افتح Supabase Dashboard
2. اذهب إلى SQL Editor
3. انسخ والصق محتوى الملف
4. اضغط على "Run" لتنفيذ السكريبت

### 7. Supabase_Admin_Setup.sql
**الوصف**: سكريبت شامل لإعداد النظام الكامل في Supabase (النسخة القديمة)
**المحتوى**:
- إنشاء جميع الجداول الأساسية
- إدراج الصلاحيات والأقسام
- إنشاء المستخدم الإداري
- إنشاء Views و Functions
- إنشاء فهارس لتحسين الأداء

**كيفية الاستخدام**:
1. افتح Supabase Dashboard
2. اذهب إلى SQL Editor
3. انسخ والصق محتوى الملف
4. اضغط على "Run" لتنفيذ السكريبت

### 8. Simple_Admin_Setup.sql
**الوصف**: سكريبت مبسط لإعداد المستخدم الإداري فقط (النسخة القديمة)
**المحتوى**:
- إنشاء الجداول الأساسية (Users, Permissions, UserPermissions)
- إدراج الصلاحيات الأساسية
- إنشاء المستخدم الإداري
- منح جميع الصلاحيات للمستخدم الإداري

**كيفية الاستخدام**:
1. افتح Supabase Dashboard
2. اذهب إلى SQL Editor
3. انسخ والصق محتوى الملف
4. اضغط على "Run" لتنفيذ السكريبت

## بيانات تسجيل الدخول الافتراضية

بعد تنفيذ أي من السكريبتات، يمكنك تسجيل الدخول باستخدام:

- **اسم المستخدم**: `admin`
- **كلمة المرور**: `admin123`

⚠️ **تحذير مهم**: يجب تغيير كلمة المرور بعد أول تسجيل دخول لأسباب أمنية.

## الصلاحيات المتاحة

النظام يتضمن الصلاحيات التالية:

### صلاحيات النظام
- `SystemAdmin`: إدارة النظام الكاملة
- `UserManagement`: إدارة المستخدمين
- `RoleManagement`: إدارة الأدوار والصلاحيات
- `SystemConfiguration`: إعدادات النظام
- `DatabaseManagement`: إدارة قاعدة البيانات

### صلاحيات الموظفين
- `EmployeeView`: عرض الموظفين
- `EmployeeCreate`: إضافة موظفين
- `EmployeeEdit`: تعديل الموظفين
- `EmployeeDelete`: حذف الموظفين

### صلاحيات المراقبين
- `ControllerView`: عرض المراقبين
- `ControllerCreate`: إضافة مراقبين
- `ControllerEdit`: تعديل المراقبين
- `ControllerDelete`: حذف المراقبين

### صلاحيات الشهادات
- `CertificateView`: عرض الشهادات
- `CertificateCreate`: إضافة شهادات
- `CertificateEdit`: تعديل الشهادات
- `CertificateDelete`: حذف الشهادات

### صلاحيات التراخيص
- `LicenseView`: عرض التراخيص
- `LicenseCreate`: إضافة تراخيص
- `LicenseEdit`: تعديل التراخيص
- `LicenseDelete`: حذف التراخيص

### صلاحيات المشاريع
- `ProjectView`: عرض المشاريع
- `ProjectCreate`: إضافة مشاريع
- `ProjectEdit`: تعديل المشاريع
- `ProjectDelete`: حذف المشاريع

### صلاحيات الملاحظات
- `ObservationView`: عرض الملاحظات
- `ObservationCreate`: إضافة ملاحظات
- `ObservationEdit`: تعديل الملاحظات
- `ObservationDelete`: حذف الملاحظات

### صلاحيات التقارير
- `ReportView`: عرض التقارير
- `ReportCreate`: إنشاء تقارير
- `ReportExport`: تصدير التقارير

### صلاحيات الإعدادات المتقدمة
- `AdvancedPermissionView`: عرض الصلاحيات المتقدمة
- `AdvancedPermissionEdit`: تعديل الصلاحيات المتقدمة
- `MenuVisibilityControl`: التحكم في إظهار القوائم
- `DataAccessControl`: التحكم في الوصول للبيانات

## الأقسام المتاحة

النظام يتضمن الأقسام التالية:

1. **إدارة النظام**: إدارة النظام والصلاحيات
2. **الموارد البشرية**: إدارة الموظفين والمراقبين
3. **التدريب والتطوير**: إدارة الشهادات والتراخيص
4. **المشاريع**: إدارة المشاريع والأنشطة
5. **الملاحظات والتقييم**: إدارة الملاحظات والتقييمات
6. **التقارير والإحصائيات**: إنتاج التقارير والإحصائيات

## Views المتاحة

### UserPermissionsView
عرض معلومات المستخدم مع صلاحياته

### AvailablePermissionsView
عرض جميع الصلاحيات المتاحة مع عدد المستخدمين الممنوحين لكل صلاحية

### DepartmentUsersView
عرض الأقسام مع عدد المستخدمين وصلاحياتهم

### ActivityLogView
عرض سجل الأنشطة مع تفاصيل المستخدم

## Functions المتاحة

### CheckUserPermission(username, permission_name)
التحقق من وجود صلاحية معينة للمستخدم

### CheckUserDepartmentPermission(username, department_name, permission_type)
التحقق من صلاحية المستخدم في قسم معين

### LogUserLogin(username)
تسجيل دخول المستخدم وتحديث تاريخ آخر تسجيل دخول

### ChangeUserPassword(username, old_password, new_password)
تغيير كلمة مرور المستخدم

### LogUserActivity(...)
تسجيل نشاط المستخدم في النظام

## استكشاف الأخطاء

### مشاكل الاتصال
إذا واجهت مشاكل في الاتصال بـ Supabase:

1. تأكد من صحة بيانات الاتصال في `appsettings.Production.json`
2. تأكد من أن Supabase project نشط
3. تأكد من صحة كلمة المرور
4. تأكد من إعدادات SSL

### مشاكل الصلاحيات
إذا لم تتمكن من الوصول لبعض الصفحات:

1. تأكد من أن المستخدم لديه الصلاحية المطلوبة
2. تحقق من إعدادات الأقسام
3. تأكد من أن المستخدم نشط

### مشاكل قاعدة البيانات
إذا واجهت أخطاء في قاعدة البيانات:

1. تأكد من تنفيذ السكريبتات بالترتيب الصحيح
2. تأكد من عدم وجود تضارب في البيانات
3. تحقق من logs النظام

## الدعم

إذا واجهت أي مشاكل، يرجى:

1. التحقق من logs النظام
2. مراجعة إعدادات الاتصال
3. التأكد من تنفيذ السكريبتات بشكل صحيح
4. التواصل مع فريق التطوير

---

**ملاحظة**: هذا النظام مصمم لإدارة الموارد البشرية في مجال الطيران ويجب استخدامه وفقاً للسياسات الأمنية المعمول بها.